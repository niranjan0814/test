(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,95508,e=>{"use strict";var a=e.i(43476),r=e.i(71645),t=e.i(7233),s=e.i(61911),d=e.i(82293),l=e.i(98919);function i({stats:e}){return(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5 hover:shadow-md transition-shadow",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,a.jsx)("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:(0,a.jsx)(s.Users,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})})}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Total Users"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:e.totalUsers})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5 hover:shadow-md transition-shadow",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center",children:(0,a.jsx)(d.UserCheck,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),(0,a.jsxs)("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:[e.totalUsers>0?(e.activeUsers/e.totalUsers*100).toFixed(0):0,"%"]})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Active Users"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:e.activeUsers})]}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-5 hover:shadow-md transition-shadow",children:[(0,a.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,a.jsx)("div",{className:"w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center",children:(0,a.jsx)(l.Shield,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})})}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"User Roles"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:e.totalRoles})]})]})}var n=e.i(88511),c=e.i(27612),o=e.i(64397);let x={getUsers:async(e="admins")=>{try{let a="admins"===e?`${o.API_BASE_URL}/admins`:`${o.API_BASE_URL}/users`,r=await fetch(a,{headers:(0,o.getHeaders)()});if(!r.ok)return[];let t=await r.json(),s=[];return t?.data?.items&&Array.isArray(t.data.items)?s=t.data.items:t?.data&&Array.isArray(t.data)?s=t.data:t?.data?.data&&Array.isArray(t.data.data)?s=t.data.data:Array.isArray(t)&&(s=t),s.map(e=>({id:e.id,name:e.full_name||e.user_name||e.name||e.email,staffId:e.user_name&&/^ST\d+/.test(e.user_name)?e.user_name:void 0,email:e.email,role:e.roles&&e.roles.length>0?e.roles[0].display_name||e.roles[0].name:e.role||"N/A",branch:e.branch?.name||(e.branch_id?"Branch "+e.branch_id:"Head Office"),status:e.is_active||"Active"===e.status||1===e.status?"Active":"Inactive"}))}catch(e){return console.error("Error fetching users",e),[]}},getStaffList:async()=>{try{let e=await fetch(`${o.API_BASE_URL}/staffs`,{headers:(0,o.getHeaders)()});if(!e.ok)return[];return(await e.json()).data||[]}catch(e){return console.error("Error fetching staff list",e),[]}},getPermissions:async()=>[{module:"Dashboard",view:!0,create:!0,edit:!0,delete:!1},{module:"Customers",view:!0,create:!0,edit:!0,delete:!1},{module:"Loans",view:!0,create:!0,edit:!0,delete:!1},{module:"Collections",view:!0,create:!0,edit:!1,delete:!1},{module:"Reports",view:!0,create:!1,edit:!1,delete:!1},{module:"Finance",view:!0,create:!0,edit:!0,delete:!0},{module:"Shareholders",view:!0,create:!0,edit:!0,delete:!0},{module:"System Config",view:!0,create:!0,edit:!0,delete:!0}],createAdmin:async e=>{let a=await fetch(`${o.API_BASE_URL}/admins`,{method:"POST",headers:(0,o.getHeaders)(),body:JSON.stringify(e)}),r=await a.json();if(!a.ok)throw Error(r.message||"Failed to create admin");return r},createUser:async e=>{let a=e.role?.toLowerCase()||"";if(a.includes("admin")||"super_admin"===a)return x.createAdmin(e);if(e.staffDetails){let a=await fetch(`${o.API_BASE_URL}/staffs`,{method:"POST",headers:(0,o.getHeaders)(),body:JSON.stringify(e.staffDetails)}),r=await a.json();if(!a.ok)throw Error(r.errors?Object.values(r.errors).flat().join(", "):r.message||"Failed to create staff");return r}let r={user_name:e.name?e.name.replace(/\s+/g,"").toLowerCase()+Math.floor(1e3*Math.random()):e.email.split("@")[0],email:e.email,password:e.password,password_confirmation:e.password,is_active:!0,roles:[parseInt(e.roleId)]},t=await fetch(`${o.API_BASE_URL}/users`,{method:"POST",headers:(0,o.getHeaders)(),body:JSON.stringify(r)}),s=await t.json();if(!t.ok)throw Error(s.message||`Failed to create ${a}`);return s},getAllRoles:async()=>{let e=await fetch(`${o.API_BASE_URL}/roles/all`,{headers:(0,o.getHeaders)()});if(!e.ok)throw console.error(`Error fetching roles: ${e.status} ${e.statusText}`),Error(`Failed to fetch roles: ${e.status} ${e.statusText}`);return(await e.json()).data},updateUser:async(e,a)=>{let r=a.role?.toLowerCase()||"";if(a.staffDetails&&a.staffId){let e=await fetch(`${o.API_BASE_URL}/staffs/${a.staffId}`,{method:"PUT",headers:(0,o.getHeaders)(),body:JSON.stringify(a.staffDetails)}),r=await e.json();if(!e.ok)throw Error(r.errors?Object.values(r.errors).flat().join(", "):r.message||"Failed to update staff");return r}let t=r.includes("admin")||r.includes("super")?`${o.API_BASE_URL}/admins/${e}`:`${o.API_BASE_URL}/users/${e}`,s=await fetch(t,{method:"PUT",headers:(0,o.getHeaders)(),body:JSON.stringify(a)}),d=await s.json();if(!s.ok)throw Error(d.message||"Failed to update user");return d},getStaffDetails:async e=>{let a=await fetch(`${o.API_BASE_URL}/staffs/${e}`,{headers:(0,o.getHeaders)()});return a.ok?(await a.json()).data:null}};var m=e.i(37727),g=e.i(63488),u=e.i(43432),b=e.i(46897),h=e.i(87316),y=e.i(84614),p=e.i(63727),f=e.i(42920);function j({staff:e,onClose:r}){return e?(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 backdrop-blur-sm",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full shadow-xl border border-gray-200 dark:border-gray-700 max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 rounded-t-lg z-10",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:"Staff Details"}),(0,a.jsx)("button",{onClick:r,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:(0,a.jsx)(m.X,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]})}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 pb-6 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("span",{className:"text-white text-2xl font-bold",children:e.full_name?.charAt(0)||e.name?.charAt(0)||"S"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:e.full_name||e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.name_with_initial||""}),(0,a.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,a.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${"active"===e.account_status||e.is_active?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-300"}`,children:"active"===e.account_status||e.is_active?"Active":"Inactive"}),(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-xs font-medium",children:e.role_name||e.role||"Staff"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.staff_id&&(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-50 dark:bg-blue-900/30 rounded-lg",children:(0,a.jsx)(p.Briefcase,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Staff ID"}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.staff_id})]})]}),(e.email_id||e.email)&&(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-purple-50 dark:bg-purple-900/30 rounded-lg",children:(0,a.jsx)(g.Mail,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Email"}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.email_id||e.email})]})]}),e.contact_no&&(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-green-50 dark:bg-green-900/30 rounded-lg",children:(0,a.jsx)(u.Phone,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Contact Number"}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.contact_no})]})]}),e.nic&&(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-orange-50 dark:bg-orange-900/30 rounded-lg",children:(0,a.jsx)(y.User,{className:"w-5 h-5 text-orange-600 dark:text-orange-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"NIC"}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.nic})]})]}),(e.age||e.gender)&&(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-pink-50 dark:bg-pink-900/30 rounded-lg",children:(0,a.jsx)(y.User,{className:"w-5 h-5 text-pink-600 dark:text-pink-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Age & Gender"}),(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:[e.age&&`${e.age} years`," ",e.gender&&`â€¢ ${e.gender}`]})]})]}),(e.branch_id||e.branch)&&(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-indigo-50 dark:bg-indigo-900/30 rounded-lg",children:(0,a.jsx)(f.Building,{className:"w-5 h-5 text-indigo-600 dark:text-indigo-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Branch"}),(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.branch?.name||e.branch||`Branch ${e.branch_id}`})]})]})]}),e.address&&(0,a.jsx)("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-teal-50 dark:bg-teal-900/30 rounded-lg",children:(0,a.jsx)(b.MapPin,{className:"w-5 h-5 text-teal-600 dark:text-teal-400"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Address"}),(0,a.jsx)("p",{className:"text-sm text-gray-900 dark:text-gray-100",children:e.address})]})]})}),e.work_info&&(0,a.jsx)("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-yellow-50 dark:bg-yellow-900/30 rounded-lg",children:(0,a.jsx)(h.Calendar,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-1",children:"Work Information"}),(0,a.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-100",children:"string"==typeof e.work_info?(0,a.jsx)("pre",{className:"whitespace-pre-wrap",children:e.work_info}):(0,a.jsxs)("div",{className:"space-y-1",children:[e.work_info.designation&&(0,a.jsxs)("p",{children:["Designation: ",e.work_info.designation]}),e.work_info.joined_date&&(0,a.jsxs)("p",{children:["Joined: ",e.work_info.joined_date]})]})})]})]})})]}),(0,a.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end bg-gray-50 dark:bg-gray-900/50 rounded-b-lg",children:(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-sm",children:"Close"})})]})}):null}function k({users:e,onEdit:t,onDelete:s}){let[d,l]=(0,r.useState)(null),[i,o]=(0,r.useState)(!1),[m,g]=(0,r.useState)(!1),u=async e=>{if(e.staffId){g(!0);try{let a=await x.getStaffDetails(e.staffId);a&&(l(a),o(!0))}catch(e){console.error("Failed to load staff details",e)}finally{g(!1)}}};return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"bg-gray-50 dark:bg-gray-900/50 border-b border-gray-200 dark:border-gray-700 px-6 py-3",children:(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-4 text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase",children:[(0,a.jsx)("div",{className:"col-span-3",children:"Name"}),(0,a.jsx)("div",{className:"col-span-3",children:"Email"}),(0,a.jsx)("div",{className:"col-span-2",children:"Role"}),(0,a.jsx)("div",{className:"col-span-2",children:"Branch"}),(0,a.jsx)("div",{className:"col-span-1",children:"Status"}),(0,a.jsx)("div",{className:"col-span-1",children:"Actions"})]})}),(0,a.jsx)("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:e.map(e=>{let r=!!e.staffId;return(0,a.jsx)("div",{className:"px-6 py-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors",children:(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-4 items-center",children:[(0,a.jsxs)("div",{className:"col-span-3 flex items-center gap-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("span",{className:"text-white text-sm font-semibold",children:e.name.charAt(0)})}),r?(0,a.jsx)("button",{onClick:()=>u(e),disabled:m,className:"font-medium text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 truncate text-left underline decoration-dotted hover:decoration-solid transition-all disabled:opacity-50",children:m?"Loading...":e.name}):(0,a.jsx)("p",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:e.name})]}),(0,a.jsx)("div",{className:"col-span-3",children:(0,a.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.email})}),(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded text-xs font-medium",children:e.role})}),(0,a.jsx)("div",{className:"col-span-2",children:(0,a.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:e.branch})}),(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsx)("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${"Active"===e.status?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-gray-100 dark:bg-gray-900/30 text-gray-700 dark:text-gray-300"}`,children:e.status})}),(0,a.jsxs)("div",{className:"col-span-1 flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>t(e),className:"p-1.5 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded text-blue-600 dark:text-blue-400",children:(0,a.jsx)(n.Edit,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>s(e.id),className:"p-1.5 hover:bg-red-50 dark:hover:bg-red-900/30 rounded text-red-600 dark:text-red-400",children:(0,a.jsx)(c.Trash2,{className:"w-4 h-4"})})]})]})},e.id)})}),(0,a.jsx)("div",{className:"bg-gray-50 dark:bg-gray-900/50 border-t border-gray-200 dark:border-gray-700 px-6 py-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",(0,a.jsx)("span",{className:"font-medium",children:e.length})," of ",(0,a.jsx)("span",{className:"font-medium",children:e.length})," users"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-800 disabled:opacity-50",children:"Previous"}),(0,a.jsx)("button",{className:"px-3 py-1 bg-blue-600 text-white rounded text-sm",children:"1"}),(0,a.jsx)("button",{className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-800 disabled:opacity-50",children:"Next"})]})]})}),i&&d&&(0,a.jsx)(j,{staff:d,onClose:()=>{o(!1),l(null)}})]})}function v({roles:e,permissions:r}){return(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Available Roles"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:e.map(e=>(0,a.jsx)("button",{className:"px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors text-sm font-medium",children:e.display_name||e},e.id||e))})]}),(0,a.jsxs)("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"bg-gray-50 dark:bg-gray-900/50 border-b border-gray-200 dark:border-gray-700 px-4 py-3",children:(0,a.jsxs)("div",{className:"grid grid-cols-5 gap-4 text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase",children:[(0,a.jsx)("div",{className:"col-span-1",children:"Module"}),(0,a.jsx)("div",{className:"col-span-1 text-center",children:"View"}),(0,a.jsx)("div",{className:"col-span-1 text-center",children:"Create"}),(0,a.jsx)("div",{className:"col-span-1 text-center",children:"Edit"}),(0,a.jsx)("div",{className:"col-span-1 text-center",children:"Delete"})]})}),(0,a.jsx)("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:r.map((e,r)=>(0,a.jsx)("div",{className:"px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:(0,a.jsxs)("div",{className:"grid grid-cols-5 gap-4 items-center",children:[(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-gray-100",children:e.module})}),(0,a.jsx)("div",{className:"col-span-1 flex justify-center",children:(0,a.jsx)("input",{type:"checkbox",checked:e.view,readOnly:!0,className:"w-4 h-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 focus:ring-blue-500"})}),(0,a.jsx)("div",{className:"col-span-1 flex justify-center",children:(0,a.jsx)("input",{type:"checkbox",checked:e.create,readOnly:!0,className:"w-4 h-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 focus:ring-blue-500"})}),(0,a.jsx)("div",{className:"col-span-1 flex justify-center",children:(0,a.jsx)("input",{type:"checkbox",checked:e.edit,readOnly:!0,className:"w-4 h-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 focus:ring-blue-500"})}),(0,a.jsx)("div",{className:"col-span-1 flex justify-center",children:(0,a.jsx)("input",{type:"checkbox",checked:e.delete,readOnly:!0,className:"w-4 h-4 text-blue-600 rounded border-gray-300 dark:border-gray-600 focus:ring-blue-500"})})]})},r))})]}),(0,a.jsx)("div",{className:"mt-4 flex justify-end",children:(0,a.jsx)("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Save Permissions"})})]})}var N=e.i(86536),w=e.i(77705),_=e.i(70319);function A({onClose:e,onSubmit:t,roles:s,initialData:d}){var l;let i,[n,c]=(0,r.useState)({name:d?.name||"",name_with_initial:d?.name_with_initial||"",email:d?.email||"",roleId:d?.role?(l=d.role,(i=s.find(e=>e.display_name===l||e.name===l))?i.id.toString():""):"",branch:d?.branch?.replace("Branch ","")||"",password:"",isActive:!d||"Active"===d.status,nic:d?.nic||"",contactKey:d?.contact_no||"",address:d?.address||"",gender:d?.gender||"Male",age:d?.age||""}),[o,g]=(0,r.useState)(!1),[u,b]=(0,r.useState)(!1),[h,y]=(0,r.useState)(!1),[p,f]=(0,r.useState)(""),[j,k]=(0,r.useState)({}),v=!!d,A=s.find(e=>e.id.toString()===n.roleId),S=A?.name==="admin"||A?.name==="super_admin"||1===s.length&&"admin"===s[0].name;(0,r.useEffect)(()=>{(async()=>{let e=d?.staffId;if(v&&!S&&e){b(!0);try{let a=await x.getStaffDetails(e);a&&c(e=>({...e,name:a.full_name||e.name,name_with_initial:a.name_with_initial||"",nic:a.nic||"",address:a.address||"",contactKey:a.contact_no||"",age:a.age?.toString()||"",gender:a.gender||"Male",branch:e.branch||a.branch_id?.toString()||"",isActive:"active"===a.account_status}))}catch(e){console.error("Failed to load staff details",e)}finally{b(!1)}}})()},[v,S,d]);let I=e=>{let a="checkbox"===e.target.type?e.target.checked:e.target.value;c({...n,[e.target.name]:a}),j[e.target.name]&&k(a=>({...a,[e.target.name]:""}))},C=async()=>{let a;if(a={},n.roleId||(a.roleId="Role is required"),S||n.name.trim()||(a.name="Full Name is required"),n.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.email)||(a.email="Invalid email format"):a.email="Email is required",!S&&(n.name_with_initial.trim()||(a.name_with_initial="Name with initials is required"),n.nic.trim()?/^([0-9]{9}[x|X|v|V]|[0-9]{12})$/.test(n.nic)||(a.nic="Invalid NIC format (9 digits+V/X or 12 digits)"):a.nic="NIC is required",n.contactKey.trim()?/^\d{10}$/.test(n.contactKey)||(a.contactKey="Contact number must be 10 digits"):a.contactKey="Contact number is required",n.address.trim()||(a.address="Address is required"),n.age?(18>parseInt(n.age)||parseInt(n.age)>80)&&(a.age="Age must be between 18 and 80"):a.age="Age is required"),v||!S||n.password||(a.password="Password is required for new admins"),k(a),0===Object.keys(a).length){g(!0);try{let a=A?.name||"",r={name:n.name,email:n.email,role:a,roleId:n.roleId,is_active:n.isActive,staffId:v?d?.staffId||d?.id:void 0};n.password&&(r.password=n.password),n.branch&&(r.branch=n.branch),S||(r.staffDetails={full_name:n.name,name_with_initial:n.name_with_initial||n.name,email_id:n.email,contact_no:n.contactKey,address:n.address,nic:n.nic,gender:n.gender,age:parseInt(n.age),role_name:a,account_status:n.isActive?"active":"inactive",work_info:{designation:a,joined_date:new Date().toISOString().split("T")[0]},profile_image:"default_avatar.png",branch_id:isNaN(parseInt(n.branch))?void 0:parseInt(n.branch)});let s=await t(r);_.toast.success(s?.message||(v?"User updated successfully":"User created successfully")),e()}catch(e){_.toast.error(e.message||"Failed to save user")}finally{g(!1)}}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4 backdrop-blur-sm overflow-y-auto",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-2xl w-full shadow-xl border border-gray-200 dark:border-gray-700 my-8 max-h-[90vh] overflow-y-auto",children:[(0,a.jsx)("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800 rounded-t-lg z-10",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100",children:v?"Edit User":"Add New User"}),(0,a.jsx)("button",{onClick:e,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded transition-colors",children:(0,a.jsx)(m.X,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"})})]})}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[p&&(0,a.jsx)("div",{className:"p-3 bg-red-50 text-red-700 text-sm rounded-lg",children:p}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Role *"}),(0,a.jsxs)("select",{name:"roleId",value:n.roleId,onChange:I,className:`w-full px-3 py-2 border ${j.roleId?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`,children:[(0,a.jsx)("option",{value:"",children:"Select Role"}),s.map(e=>(0,a.jsx)("option",{value:e.id,children:e.display_name},e.id))]}),j.roleId&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.roleId})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[!S&&(0,a.jsxs)("div",{className:"col-span-1 md:col-span-2",children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Full Name *"}),(0,a.jsx)("input",{name:"name",value:n.name,onChange:I,type:"text",className:`w-full px-3 py-2 border ${j.name?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm disabled:opacity-50 disabled:bg-gray-100 dark:disabled:bg-gray-700`,placeholder:"Enter full name",disabled:v&&S}),j.name&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.name})]}),!S&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Name with Initials *"}),(0,a.jsx)("input",{name:"name_with_initial",value:n.name_with_initial,onChange:I,type:"text",className:`w-full px-3 py-2 border ${j.name_with_initial?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`,placeholder:"e.g. A.B.C Perera"}),j.name_with_initial&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.name_with_initial})]}),(0,a.jsxs)("div",{className:S?"col-span-1 md:col-span-2":"",children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Email *"}),(0,a.jsx)("input",{name:"email",value:n.email,onChange:I,type:"email",className:`w-full px-3 py-2 border ${j.email?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`,placeholder:"user@example.com"}),j.email&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.email})]})]}),!S&&(0,a.jsxs)("div",{className:"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider",children:"Staff Details"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"NIC Number *"}),(0,a.jsx)("input",{name:"nic",value:n.nic,onChange:I,type:"text",className:`w-full px-3 py-2 border ${j.nic?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`,placeholder:"National Identity Card"}),j.nic&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.nic})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Contact Number *"}),(0,a.jsx)("input",{name:"contactKey",value:n.contactKey,onChange:I,type:"text",className:`w-full px-3 py-2 border ${j.contactKey?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`,placeholder:"Mobile Number"}),j.contactKey&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.contactKey})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Age *"}),(0,a.jsx)("input",{name:"age",value:n.age,onChange:I,type:"number",min:"18",max:"80",className:`w-full px-3 py-2 border ${j.age?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`}),j.age&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.age})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Gender *"}),(0,a.jsxs)("select",{name:"gender",value:n.gender,onChange:I,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm",children:[(0,a.jsx)("option",{value:"Male",children:"Male"}),(0,a.jsx)("option",{value:"Female",children:"Female"})]})]}),(0,a.jsxs)("div",{className:"col-span-1 md:col-span-2",children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Residential Address *"}),(0,a.jsx)("textarea",{name:"address",value:n.address,onChange:I,rows:3,className:`w-full px-3 py-2 border ${j.address?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`,placeholder:"Full Address"}),j.address&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.address})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:"Branch *"}),(0,a.jsxs)("select",{name:"branch",value:n.branch,onChange:I,className:`w-full px-3 py-2 border ${j.branch?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm`,children:[(0,a.jsx)("option",{value:"",children:"Select Branch"}),(0,a.jsx)("option",{value:"Head Office",children:"Head Office"}),(0,a.jsx)("option",{value:"Kandy Branch",children:"Kandy Branch"}),(0,a.jsx)("option",{value:"Galle Branch",children:"Galle Branch"})]}),j.branch&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.branch})]})]})]}),!v&&(0,a.jsxs)("div",{className:"relative pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("label",{className:"block font-medium text-gray-900 dark:text-gray-100 mb-2 text-sm",children:["Password ",S?"*":"(Optional - defaults to NIC)"]}),(0,a.jsx)("input",{name:"password",value:n.password,onChange:I,type:h?"text":"password",className:`w-full px-3 py-2 border ${j.password?"border-red-500":"border-gray-300 dark:border-gray-600"} dark:bg-gray-700 dark:text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm pr-10`,placeholder:"Enter password"}),j.password&&(0,a.jsx)("p",{className:"text-red-500 text-xs mt-1",children:j.password}),(0,a.jsx)("button",{type:"button",onClick:()=>y(!h),className:"absolute right-3 top-[60%] text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200",children:h?(0,a.jsx)(w.EyeOff,{className:"w-4 h-4"}):(0,a.jsx)(N.Eye,{className:"w-4 h-4"})})]}),v&&(0,a.jsx)("div",{className:"flex items-center gap-3 pt-2",children:(0,a.jsxs)("label",{className:"relative inline-flex items-center cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",name:"isActive",checked:n.isActive,onChange:I,className:"sr-only peer"}),(0,a.jsx)("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"}),(0,a.jsx)("span",{className:"ml-3 text-sm font-medium text-gray-900 dark:text-gray-300",children:n.isActive?"Active User":"Inactive User"})]})})]}),(0,a.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex gap-3 justify-end bg-gray-50 dark:bg-gray-900/50 rounded-b-lg",children:[(0,a.jsx)("button",{onClick:e,disabled:o,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-white dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 transition-colors font-medium text-sm disabled:opacity-50",children:"Cancel"}),(0,a.jsx)("button",{onClick:C,disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium text-sm disabled:opacity-50 flex items-center gap-2",children:o?v?"Updating...":"Adding...":v?"Update User":"Add User"})]})]})})}function S(){let[e,s]=(0,r.useState)("users"),[d,l]=(0,r.useState)(!1),[n,c]=(0,r.useState)([]),[o,m]=(0,r.useState)([]),[g,u]=(0,r.useState)([]),[b,h]=(0,r.useState)(!0),[y,p]=(0,r.useState)(null),[f,j]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=localStorage.getItem("roles");if(e)try{let a=JSON.parse(e);Array.isArray(a)&&a.length>0&&(a.some(e=>"super_admin"===e.name)?j("super_admin"):a.some(e=>"admin"===e.name)?j("admin"):j(a[0].name))}catch(e){}N()},[]);let N=async()=>{try{let e=!1;{let a=localStorage.getItem("roles");a&&a.includes("super_admin")&&(e=!0)}let a=e?"admins":"staff",[r,t,s]=await Promise.all([x.getUsers(a),x.getAllRoles(),x.getPermissions()]);c(r),m(t),u(s)}catch(e){console.error("Failed to load staff data",e)}finally{h(!1)}},w=async e=>{let a;return a=y?await x.updateUser(y.id,e):await x.createUser(e),l(!1),p(null),N(),a},_={totalUsers:n.length,activeUsers:n.filter(e=>"Active"===e.status).length,totalRoles:o.length};return b?(0,a.jsx)("div",{className:"p-6",children:"Loading..."}):(0,a.jsxs)("div",{className:"space-y-6 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"User Management"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1",children:"Manage users, roles, and permissions"})]}),"users"===e&&(0,a.jsxs)("button",{onClick:()=>{p(null),l(!0)},className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors shadow-sm",children:[(0,a.jsx)(t.Plus,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Add User"})]})]}),(0,a.jsx)(i,{stats:_}),(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("div",{className:"border-b border-gray-200 dark:border-gray-700",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("button",{onClick:()=>s("users"),className:`px-6 py-3 border-b-2 transition-colors text-sm font-medium ${"users"===e?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"Staff Users"}),(0,a.jsx)("button",{onClick:()=>s("roles"),className:`px-6 py-3 border-b-2 transition-colors text-sm font-medium ${"roles"===e?"border-blue-600 text-blue-600 dark:text-blue-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"Roles & Privileges"})]})}),"users"===e&&(0,a.jsx)(k,{users:n,onEdit:e=>{p(e),l(!0)},onDelete:e=>console.log("Delete",e)}),"roles"===e&&(0,a.jsx)(v,{roles:o,permissions:g})]}),d&&(0,a.jsx)(A,{onClose:()=>{l(!1),p(null)},onSubmit:w,initialData:y,roles:o.filter(e=>"super_admin"===f?"admin"===e.name:"admin"!==f||"super_admin"!==e.name&&"admin"!==e.name)})]})}e.s(["default",()=>S],95508)}]);